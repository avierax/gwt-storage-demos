<!doctype html>
<!-- The DOCTYPE declaration above will set the     -->
<!-- browser's rendering engine into                -->
<!-- "Standards Mode". Replacing this declaration   -->
<!-- with a "Quirks Mode" doctype is not supported. -->

<html>
  <head>
    <meta charset=UTF-8>

    <!--                                                               -->
    <!-- Consider inlining CSS to reduce the number of requested files -->
    <!--                                                               -->
    <link type="text/css" rel="stylesheet" href="gwt-storage-test.css">
    <link rel="stylesheet" href="storagedemo.css">

    <!--                                           -->
    <!-- Any title is fine                         -->
    <!--                                           -->
    <title>Web Application Starter Project</title>
    
    <!--                                           -->
    <!-- This script loads your compiled module.   -->
    <!-- If you add any GWT meta tags, they must   -->
    <!-- be added before this line.                -->
    <!--                                           -->
    <script src="gwtstoragetest/gwtstoragetest.nocache.js"></script>
  </head>

  <!--                                           -->
  <!-- The body can have arbitrary html, or      -->
  <!-- you can leave the body empty if you want  -->
  <!-- to create a completely dynamic UI.        -->
  <!--                                           -->
  <body>
  <section id="wrapper">
    <header>
      <h1>Storage</h1>
    </header>

    <style>
      article div {
        margin: 10px 0;
      }

      label {
        float: left;
        display: block;
        width: 125px;
        line-height: 32px;
      }
    </style>
    <article>
      <section>
        <p>Values are stored on <code>keyup</code></p>
        <p>Content loaded from previous sessions:</p>
        <ul id="previous"></ul>
      </section>
      <section>
        <div>
          <label for="session">sessionStorage:</label>
          <input type="text" name="session" value="" id="session" />
        </div>
        <div>
          <label for="local">localStorage:</label>
          <input type="text" name="local" value="" id="local" />
        </div>
        <input type="button" id="clear" value="Clear storage" />
      </section>
    </article>
    <script>

        function getStorage(type) {
            var storage = window[type + 'Storage'],
                delta = 0,
                li = document.createElement('li');

            if (!window[type + 'Storage']) return;

            if (storage.getItem('value')) {
                delta = ((new Date()).getTime() - (new Date()).setTime(storage.getItem('timestamp'))) / 1000;

                li.innerHTML = type + 'Storage: ' + storage.getItem('value') + ' (last updated: ' + delta + 's ago)';
            } else {
                li.innerHTML = type + 'Storage is empty';
            }

            document.querySelector('#previous').appendChild(li);
        }

        getStorage('session');
        getStorage('local');

        addEvent(document.querySelector('#session'), 'keyup', function () {
            sessionStorage.setItem('value', this.value);
            sessionStorage.setItem('timestamp', (new Date()).getTime());
        });

        addEvent(document.querySelector('#local'), 'keyup', function () {
            localStorage.setItem('value', this.value);
            localStorage.setItem('timestamp', (new Date()).getTime());
        });

        addEvent(document.querySelector('#clear'), 'click', function () {
            sessionStorage.clear();
            localStorage.clear();

            document.querySelector('#previous').innerHTML = '';
            getStorage('local');
            getStorage('session');
        });

    </script>
    <a id="html5badge" href="http://www.w3.org/html/logo/"></a>
  </section>
  </body>
</html>
